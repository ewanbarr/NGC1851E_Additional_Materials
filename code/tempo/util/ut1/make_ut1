#! /usr/bin/perl

# Create a ut1.dat file out of ut1_tai.dat
#
# Run get_ut1 to retr current ut1_tai.dat from hpiers.obspm.fr

$datf = "ut1_tai.dat";
$mjdmax=0;
open (IN, $datf) or die "Error opening $datf\n";
while (<IN>) {
    chomp;
    s/^\s+//;
    if (/^#/) { next; }
    ($mjd, $diff, $sig) = split;
    $imjd = int($mjd);
    $ut1{$imjd} = int(-10.0*$diff + 0.5);
    if ($imjd>$mjdmax) { $mjdmax=$imjd; }
}

# Header and pre-1972 data from old ut1.dat
print <<'EOF';
IH79 TAI-UT1: All data from IERS EOP C04
(A3,2X,I5,6(I7,1X),2X,I2)       2 2440219 2460000  6  5           1.E-4
     40219  70143   70247   70355   70497   70607   70746
     40249  70873   70978   71127   71275   71415   71580
     40279  71705   71846   72020   72161   72337   72499
     40309  72637   72816   72977   73131   73308   73443
     40339  73589   73755   73879   74033   74164   74278
     40369  74433   74573   74709   74847   74935   75032
     40399  75144   75227   75349   75441   75525   75644
     40429  75740   75846   75955   76023   76121   76236
     40459  76334   76482   76599   76717   76874   77005
     40489  77156   77311   77427   77576   77734   77871
     40519  78048   78182   78309   78464   78590   78746
     40549  78904   79031   79187   79340   79473   79632
     40579  79749   79873   80029   80162   80332   80488
     40609  80612   80764   80908   81047   81225   81361
     40639  81510   81678   81814   81988   82146   82281
     40669  82454   82617   82781   82978   83124   83280
     40699  83450   83587   83760   83911   84036   84188
     40729  84317   84448   84598   84703   84825   84951
     40759  85046   85177   85275   85361   85477   85570
     40789  85675   85789   85855   85944   86039   86120
     40819  86255   86353   86446   86569   86671   86798
     40849  86945   87053   87192   87327   87446   87617
     40879  87757   87899   88066   88207   88374   88548
     40909  88681   88835   88980   89110   89275   89396
     40939  89516   89653   89770   89923   90072   90189
     40969  90333   90462   90584   90741   90846   90963
     40999  91092   91195   91342   91485   91611   91775
     41029  91927   92080   92276   92422   92580   92742
     41059  92877   93049   93212   93356   93527   93679
     41089  93834   94019   94154   94298   94438   94551
     41119  94699   94824   94930   95057   95159   95278
     41149  95423   95530   95655   95773   95869   96012
     41179  96128   96243   96386   96509   96655   96822
     41209  96945   97093   97237   97375   97569   97737
     41239  97903   98082   98237   98417   98621   98788
     41269  98978   99149   99302   99489   99642   99794
     41299  99950  100075  100225  100381  100509  100666
EOF

# Format in ut1.dat style, print out.
$mjd0 = 41329; 
$pos = 0;
for ($i=$mjd0; $i<$mjdmax; $i+=30) {

    $line = sprintf("%10d",$i);
    $nval = 6;

    for ($j=0; $j<30; $j+=5) {
        $mjd = $i+$j;
        if ($mjd<=$mjdmax) { 
            $d=$ut1{$mjd}; 
            $line .= sprintf("%7d ", $d);
        } else {
            $line .= "        ";
            $nval--;
        }
    }
    chop $line;

    if ($nval<6) {
        $line .= sprintf("  %02d", $nval);
    }

    # At end of line, print
    print $line . "\n"; 
}

# Need this?
print "END\n";

